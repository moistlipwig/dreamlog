<form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form" autocomplete="off">
  @if (errorMessage()) {
    <div class="error-message bg-red-50 text-red-800 p-3 rounded-md mb-4" role="alert">
      {{ errorMessage() }}
    </div>
  }

  <mat-form-field appearance="outline" class="w-full">
    <input
      matInput
      formControlName="username"
      type="email"
      placeholder="your@email.com"
      autocomplete="email"
      autocapitalize="off"
      spellcheck="false"
      inputmode="email"
      (blur)="onFieldBlur('username')"
      [attr.aria-invalid]="loginForm.get('username')?.invalid && shouldShowError('username')"
    />
    @if (loginForm.get('username')?.invalid && shouldShowError('username')) {
      <div class="error-container" role="alert" aria-live="polite">
        @if (loginForm.get('username')?.hasError('required')) {
          <mat-error><span class="error-icon">⚠️</span> Email is required</mat-error>
        }
        @if (loginForm.get('username')?.hasError('email')) {
          <mat-error><span class="error-icon">⚠️</span> Please enter a valid email</mat-error>
        }
      </div>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="w-full">
    <input
      matInput
      formControlName="password"
      type="password"
      placeholder="Enter your password"
      autocomplete="current-password"
      autocapitalize="off"
      spellcheck="false"
      (blur)="onFieldBlur('password')"
      [attr.aria-invalid]="loginForm.get('password')?.invalid && shouldShowError('password')"
    />
    @if (loginForm.get('password')?.invalid && shouldShowError('password')) {
      <div class="error-container" role="alert" aria-live="polite">
        @if (loginForm.get('password')?.hasError('required')) {
          <mat-error><span class="error-icon">⚠️</span> Password is required</mat-error>
        }
        @if (loginForm.get('password')?.hasError('minlength')) {
          <mat-error><span class="error-icon">⚠️</span> Password must be at least 8 characters</mat-error>
        }
      </div>
    }
  </mat-form-field>

  <button
    mat-flat-button
    color="primary"
    type="submit"
    class="w-full"
    [disabled]="isLoading()"
  >
    @if (isLoading()) {
      Signing in...
    } @else {
      Sign In
    }
  </button>
</form>
