<div class="dream-edit-container">
  <!-- Compact Header -->
  <div class="edit-header">
    <button mat-icon-button routerLink="/app/dreams" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>
      <span aria-hidden="true">✍️</span>
      {{ isEditMode ? 'Edit Your Dream' : 'Record Your Dream' }}
    </h1>
  </div>

  <form [formGroup]="form" (ngSubmit)="save()" class="dream-form">
    <!-- Two-Column Layout: Content (left) + Metadata (right) -->
    <div class="form-grid">
      <!-- LEFT: Dream Content (60%) -->
      <div class="content-section">
        <div class="title-row">
          <label for="dream-title" class="field-label">
            <mat-icon>title</mat-icon>
            Dream title
          </label>
          <mat-form-field appearance="outline" class="title-field">
            <input
              id="dream-title"
              matInput
              formControlName="title"
              placeholder="A stroll above the clouds"
              maxlength="120"
            />
            <mat-hint align="end">{{ form.controls.title.value?.length || 0 }}/120</mat-hint>
          </mat-form-field>
        </div>
        <label for="dream-content" class="content-label">What did you dream about?</label>
        <textarea
          id="dream-content"
          class="content-textarea"
          formControlName="content"
          placeholder="I was standing in a vast field of flowers..."
          required
          [class.error]="form.controls.content.hasError('required') && form.controls.content.touched"
        ></textarea>
        @if (form.controls.content.hasError('required') && form.controls.content.touched) {
          <div class="error-hint">
            <mat-icon>warning</mat-icon>
            Dream description is required
          </div>
        }
      </div>

      <!-- RIGHT: Metadata Card (40%) -->
      <div class="metadata-card">
        <!-- Date -->
        <div class="field-compact">
          <label for="dream-date" class="field-label">
            <mat-icon>event</mat-icon>
            Date
          </label>
          <mat-form-field appearance="outline">
            <input id="dream-date" matInput [matDatepicker]="picker" formControlName="date" required/>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Tags -->
        <div class="field-compact">
          <label for="dream-tags" class="field-label">
            <mat-icon>label</mat-icon>
            Tags
          </label>
          <mat-form-field appearance="outline">
            <input id="dream-tags" matInput formControlName="tags" placeholder="flying, ocean..."/>
          </mat-form-field>
        </div>

        <!-- Mood During Dream -->
        <div class="field-compact">
          <label for="mood-in-dream" class="field-label">
            <mat-icon>mood</mat-icon>
            Mood during dream
          </label>
          <mat-form-field appearance="outline">
            <mat-select id="mood-in-dream" formControlName="moodInDream" placeholder="Select">
              <mat-option [value]="null">Not specified</mat-option>
              @for (mood of moodOptions; track mood.value) {
                <mat-option [value]="mood.value">{{ mood.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Mood After Waking -->
        <div class="field-compact">
          <label for="mood-after-dream" class="field-label">
            <mat-icon>wb_twilight</mat-icon>
            Mood after waking
          </label>
          <mat-form-field appearance="outline">
            <mat-select id="mood-after-dream" formControlName="moodAfterDream" placeholder="Select">
              <mat-option [value]="null">Not specified</mat-option>
              @for (mood of moodOptions; track mood.value) {
                <mat-option [value]="mood.value">{{ mood.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Vividness -->
        <div class="field-compact">
          <label for="dream-vividness" class="field-label">
            <mat-icon>visibility</mat-icon>
            Vividness: {{ form.controls.vividness.value }}/10
          </label>
          <mat-slider min="0" max="10" step="1" discrete showTickMarks>
            <input id="dream-vividness" matSliderThumb formControlName="vividness"/>
          </mat-slider>
        </div>

        <!-- Lucid -->
        <div class="field-compact lucid-field">
          <mat-checkbox formControlName="lucid">
            <mat-icon>lightbulb</mat-icon>
            Lucid Dream
          </mat-checkbox>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    @if (error()) {
      <div class="form-error">
        <mat-icon>error</mat-icon>
        {{ error() }}
      </div>
    }

    <!-- Action Buttons (Fixed at bottom) -->
    <div class="actions">
      <button mat-stroked-button type="button" routerLink="/app/dreams" [disabled]="isSaving()" class="btn-cancel">
        Cancel
      </button>
      <button mat-flat-button type="submit" [disabled]="form.invalid || isSaving()" class="btn-save">
        @if (isSaving()) {
          <mat-spinner diameter="18" class="spinner"></mat-spinner>
          Saving...
        } @else {
          Save Dream
        }
      </button>
    </div>
  </form>
</div>
